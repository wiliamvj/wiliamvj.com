<!DOCTYPE html>
<html lang="pt" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>    
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Utilizando Testcontainers para Testes de Integração com NestJS e Prisma ORM</title>
<meta
  name="apple-mobile-web-app-title"
  content="Utilizando Testcontainers para Testes de Integração com NestJS e Prisma ORM"
/>
<meta
  name="description"
  content="Introdução Neste guia, exploraremos como realizar testes de integração em nossa aplicação usando uma combinação poderosa de tecnologias: NestJs junto com o Prisma ORM, e aproveitando os recursos do Testcontainers."
/>
<link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/icons/apple-touch.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/icons/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/icons/favicon-16x16.png"
/>
<link rel="canonical" href="//localhost:1313/posts/teste-integracao-nestjs/" />
<link rel="robots" href="/robots.txt" />
<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />


<script
  defer
  src="https://www.googletagmanager.com/gtag/js?id=G-TG8KZ9PQBT"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'G-TG8KZ9PQBT');
</script>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="//localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto">
    <div class="header">
      <header
  class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 sm:py-12"
>
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="//localhost:1313/">
    <img
      srcset="/img/profile-picture_hucbf2afd9e62dc6021c155b0731b41164_625734_80x80_fill_q90_box_smart1.jpg 80w"
      src="/img/profile-picture.jpg"
      width="1080"
      height="1080"
      alt="Wiliam V. Joaquim"
    />
  </a>
</div>


  <div class="flex flex-col gap-5">
    <a href="//localhost:1313/">
  <h1 id="site-title">Wiliam V<span class="text-wpurple">.</span> Joaquim</h1>
</a>
 <nav>
  <ul class="px-4 lg:px-0">
     
    <li>
      <a
        href="/"
        class=""
        
      >
        Artigos
      </a>
      <span class="text-wpurple text-lg">.</span>
    </li>
    
    <li>
      <a
        href="https://wiliamvj.substack.com/"
        class=""
         target="_blank" 
      >
        Newsletter
      </a>
      <span class="text-wpurple text-lg">.</span>
    </li>
    
    <li>
      <a
        href="/en/"
        class=""
        
      >
        en-US
      </a>
      <span class="text-wpurple text-lg">.</span>
    </li>
    
    <li class="-mt-2 block lg:hidden"><button
  class="toggle-theme"
  aria-label="Toggle Theme"
  title="Toggle Theme"
  onclick="toggleTheme()"
>
  <span class="theme-icon light hidden dark:block">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>
  </span>
  <span class="theme-icon dark block dark:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>
  </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');
    setTheme(theme);
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      html.classList.remove('dark');
      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      html.classList.add('dark');
      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');
    const newTheme = theme === 'light' ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    setTheme(newTheme);
  }
</script>
</li>
  </ul>
</nav>

  </div>
</header>

      <div class="lg:inline-block hidden">
        <button
  class="toggle-theme"
  aria-label="Toggle Theme"
  title="Toggle Theme"
  onclick="toggleTheme()"
>
  <span class="theme-icon light hidden dark:block">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>
  </span>
  <span class="theme-icon dark block dark:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>
  </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');
    setTheme(theme);
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      html.classList.remove('dark');
      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      html.classList.add('dark');
      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');
    const newTheme = theme === 'light' ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    setTheme(newTheme);
  }
</script>

      </div>
    </div>

    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-small">Utilizando Testcontainers para Testes de Integração com NestJS e Prisma ORM</h2>

    <div class="meta">
      
      <time
        datetime="2024-03-16 19:03:34 -0300 -03"
        title='Sat, Mar 16, 2024, 7:03 PM -03'
      >
        Publicado em: 16/03/2024 - 8 minutos de leitura
      </time>

       
    </div>
  </header>

  

  <section><p><img alt="thumbnail" src="/posts/teste-integracao-nestjs/thumb_fd435fgh5y.png"></p>
<h2 id="introdução">Introdução</h2>
<p>Neste guia, exploraremos como realizar testes de integração em nossa aplicação usando uma combinação poderosa de tecnologias: <a href="https://nestjs.com/">NestJs</a> junto com o <a href="https://www.prisma.io/">Prisma ORM</a>, e aproveitando os recursos do <a href="https://testcontainers.com/">Testcontainers</a>.</p>
<p>O foco deste post é mostrar como integrar o Testcontainers em aplicações NestJS com Prisma, proporcionando testes robustos e eficientes. Embora não abordemos a criação e configuração inicial do projeto, irei explicar brevemente a estrutura básica que adotaremos.</p>
<p>Nosso projeto será composto por apenas três endpoints: criar usuário, atualizar e listar por ID.</p>
<p><img alt="project struct" src="/posts/teste-integracao-nestjs/fgYT567gfhfgh.png"></p>
<p>Vamos utilizar constratos, já fiz um <a href="/posts/nestjs-contratos/">post</a> sobre isso também, e postgres para banco de dados.</p>
<h2 id="o-que-é-testcontainers">O que é Testcontainers?</h2>
<p>Antes de mergulharmos nos testes de integração, é importante compreender o papel do Testcontainers. Esses testes são cruciais para garantir o funcionamento fluido de uma aplicação, pois abrangem o teste de todo o fluxo de funcionalidades. Embora os testes unitários tenham seu lugar, os testes de integração oferecem uma cobertura mais abrangente.</p>
<p>No entanto, os testes de integração podem ser complexos, pois exigem a execução de vários componentes essenciais antes de iniciar os testes. É aqui que entra o <a href="https://testcontainers.com/">Testcontainers</a>.</p>
<p>O Testcontainers facilita a execução dos componentes necessários para a aplicação, como um banco de dados. Por exemplo, se precisarmos de um banco de dados Postgres, o Testcontainers inicia uma instância temporária do Postgres para nós, executa os testes e, em seguida, limpa o ambiente, excluindo o container.</p>
<h2 id="como-vamos-utilizar">Como vamos utilizar?</h2>
<p>Vamos utilizar o jest para realizar os testes e o <a href="https://www.npmjs.com/package/supertest">supertest</a> para fazer nossas chamadas http, a ideia seria:</p>
<p><strong>No inicio de todos os teste:</strong></p>
<ul>
<li>Iniciar o Testcontainers juntamente com postgres</li>
<li>Iniciar o prisma</li>
<li>Criar uma instância da nossa aplicação</li>
</ul>
<p><strong>A cada caso de teste:</strong></p>
<ul>
<li>Resetamos o banco e garantimos isolamento dos testes</li>
<li>Rodamos as migrations</li>
</ul>
<p><strong>No fim de todos os teste:</strong></p>
<ul>
<li>Desconectamos o prisma do banco</li>
<li>Finalizamos o postgres</li>
<li>Paramos o container</li>
</ul>
<p>Poderíamos fazer todas as etapas acima a cada caso de teste, se tivermos 10 casos de teste, vamos levantar 10 containers, porém ficaria mais lento a cada teste subir um novo container com postgres, dessa forma vamos levantar apenas 1 container, fica mais rápido apenas limpar o banco e rodar as migrations novamente, mas cada cenário pede uma abordagem, em nosso exemplo esse cenários serve muito bem, mas caso seja melhor para o seu caso, você pode fazer exatamente como as <a href="https://node.testcontainers.org/modules/postgresql/">docs</a> do Testcontainers fazem.</p>
<h2 id="configurando-o-jest">Configurando o Jest</h2>
<p>Antes de iniciar com testecotainers precisamos ajustar algumas coisas do jest, por padrão o nestJS criar alguns arquivos para teste e2e, vamos precisar ajustar.</p>
<p>Vamos renomear o arquivo chamado <code>jest-e2e.json</code> que fica na pasta <strong>test</strong> para <code>jest-integration.json</code> e vamos alterar o <code>testRegex</code> para buscar todos os arquivos com <code>.integration.spec.ts</code> no nome, você pode chamar o arquivo da forma que deseja, vai ficar asssim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;moduleFileExtensions&#34;</span>: [<span style="color:#f1fa8c">&#34;js&#34;</span>, <span style="color:#f1fa8c">&#34;json&#34;</span>, <span style="color:#f1fa8c">&#34;ts&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;rootDir&#34;</span>: <span style="color:#f1fa8c">&#34;.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;testEnvironment&#34;</span>: <span style="color:#f1fa8c">&#34;node&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;testRegex&#34;</span>: <span style="color:#f1fa8c">&#34;.integration.spec.ts$&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;transform&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;^.+\\.(t|j)s$&#34;</span>: <span style="color:#f1fa8c">&#34;ts-jest&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Vamos criar também um novo script para rodas os testes no <code>package.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;test:integration&#34;</span>: <span style="color:#f1fa8c">&#34;jest --config ./test/jest-integration.json&#34;</span>
</span></span></code></pre></div><p>Com isso temos o script pronto, basta rodas <code>nom run test:integration</code> ou <code>yarn test:integration</code></p>
<h2 id="instalando-os-pacotes">Instalando os pacotes</h2>
<p>Vamos precisar de alguns pacotes, são eles:</p>
<p>O pacote do testcontainers</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install testcontainers --save-dev
</span></span></code></pre></div><p>O pacote do postgres para o Testcontainers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install @testcontainers/postgresql --save-dev
</span></span></code></pre></div><p>O pacote do drive do pg (postgres)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install pg
</span></span></code></pre></div><p>O pacote do super test</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install supertest --save-dev
</span></span></code></pre></div><p>Com isso temos todos os pacotes necessários.</p>
<h2 id="iniciado-os-testes">Iniciado os testes</h2>
<p>Vamos renomear o arquivo <code>app.e2e-spec.ts</code> criado pelo nestJS para <code>user.integration.spec.ts</code>, como vamos iniciar apenas 1 instância do postgres via container para todos os testes, precisamos deixar acessível de forma global, por isso vamos iniciar assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> container: <span style="color:#8be9fd">StartedPostgreSqlContainer</span>; <span style="color:#6272a4">// importamos do pacote testcontainers/postgresql
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">let</span> prismaClient: <span style="color:#8be9fd">PrismaClient</span>; <span style="color:#6272a4">// importamos do Prisma Client
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">let</span> app: <span style="color:#8be9fd">INestApplication</span>; <span style="color:#6272a4">// importamos nestjs common
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">let</span> urlConnection: <span style="color:#8be9fd">string</span>; <span style="color:#6272a4">// a url do banco que sera criada pelo testcontainers
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">let</span> client: <span style="color:#8be9fd">Client</span>; <span style="color:#6272a4">// importamos do pacote pg
</span></span></span></code></pre></div><p>Isso vai nos permitir acessar fora do <code>beforeAll</code> que vamos criar.</p>
<p>Vamos iniciar tudo dentro de um <code>beforeAll</code> do jest, vamos primeiro estar o <code>PostgreSqlContainer</code> depois vamos criar um <code>Client</code> do postgres com o pacote <a href="https://www.npmjs.com/package/pg">pg</a>, conectamos o prisma ao banco e por fim iniciamos o nestJS, também pegamos a url de conexão com o postgres e atribuímos a variável <code>DATABASE_URL</code> que é usada por padrão pelo prisma.</p>
<p>vai ficar assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>beforeAll(<span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  container <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> <span style="color:#ff79c6">new</span> PostgreSqlContainer().start();
</span></span><span style="display:flex;"><span>  client <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Client({
</span></span><span style="display:flex;"><span>    host: <span style="color:#8be9fd">container.getHost</span>(),
</span></span><span style="display:flex;"><span>    port: <span style="color:#8be9fd">container.getPort</span>(),
</span></span><span style="display:flex;"><span>    user: <span style="color:#8be9fd">container.getUsername</span>(),
</span></span><span style="display:flex;"><span>    password: <span style="color:#8be9fd">container.getPassword</span>(),
</span></span><span style="display:flex;"><span>    database: <span style="color:#8be9fd">container.getDatabase</span>(),
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">await</span> client.connect();
</span></span><span style="display:flex;"><span>  process.env.DATABASE_URL <span style="color:#ff79c6">=</span> container.getConnectionUri();
</span></span><span style="display:flex;"><span>  urlConnection <span style="color:#ff79c6">=</span> container.getConnectionUri();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// create a new instance of PrismaClient with the connection string
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  prismaClient <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> PrismaClient({
</span></span><span style="display:flex;"><span>    datasources<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      db<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>        url: <span style="color:#8be9fd">urlConnection</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// start the nestjs application
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">const</span> <span style="color:#ff79c6">module</span>Ref <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> Test.createTestingModule({
</span></span><span style="display:flex;"><span>    imports<span style="color:#ff79c6">:</span> [AppModule],
</span></span><span style="display:flex;"><span>  }).compile();
</span></span><span style="display:flex;"><span>  app <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">module</span>Ref.createNestApplication();
</span></span><span style="display:flex;"><span>  app.useGlobalPipes(<span style="color:#ff79c6">new</span> ValidationPipe());
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">await</span> app.init();
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Agora vamos fazer nosso <code>afterAll</code> que vai ser executado ao terminar todos os testes, basicamente finalizamos tudo que iniciamos no <code>beforeAll</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>afterAll(<span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">await</span> prismaClient.$disconnect();
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">await</span> client.end();
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">await</span> container.stop();
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Com isso temos quase tudo pronto para criar os casos de teste, mas precisamos garantir que a cada caso de teste, o que foi gerado por um caso não afete o outro, para isso vamos fazer um <code>beforeEach</code> que antes de cada caso de teste vai resetar o banco e rodas as migrations, garantindo que cada caso de teste tenho o banco zerado.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>beforeEach(<span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// drop schema and create a new one
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  execSync(<span style="color:#f1fa8c">`npx prisma migrate reset --force`</span>, {
</span></span><span style="display:flex;"><span>    env<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      ...process.env,
</span></span><span style="display:flex;"><span>      DATABASE_URL: <span style="color:#8be9fd">urlConnection</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  execSync(<span style="color:#f1fa8c">`npx prisma migrate deploy`</span>, {
</span></span><span style="display:flex;"><span>    env<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>      ...process.env,
</span></span><span style="display:flex;"><span>      DATABASE_URL: <span style="color:#8be9fd">urlConnection</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Usamos o <code>execSync</code> para executar comandos no <code>shell</code>, resetando o banco com o comando do prisma cli, mas é preciso usar o <code>--force</code> para forçar o reset, sem isso o prisma pede uma confirmação manual.</p>
<p>Depois de resetar, rodamos as migrations, passando a url de conexão que colocamos no <code>urlConnection</code> no nosso <code>beforeAll</code>. Também vamos criar um <code>afterEach</code> para limpar os mocks do jest e garantir que nenhum mock que possa ser criado influencie os demais testes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>afterEach(() <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  jest.restoreAllMocks();
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Com isso temos as configurações de teste prontas, agora é só escrever os testes.</p>
<h2 id="criando-os-casos-de-teste">Criando os casos de teste</h2>
<p>Vamos usar o <a href="https://www.npmjs.com/package/supertest">super test</a> para chamar nosso endpoint de criação de usuários:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>describe(<span style="color:#f1fa8c">&#39;[/user] POST&#39;</span>, () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  it(<span style="color:#f1fa8c">&#39;should create a user&#39;</span>, <span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userData: <span style="color:#8be9fd">UserDto</span> <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>      email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;john.doe@email.com&#39;</span>,
</span></span><span style="display:flex;"><span>      first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John&#39;</span>,
</span></span><span style="display:flex;"><span>      last_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Doe&#39;</span>,
</span></span><span style="display:flex;"><span>      password<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;password@1234&#39;</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> request(app.getHttpServer()).post(<span style="color:#f1fa8c">&#39;/user&#39;</span>).send(userData).expect(<span style="color:#bd93f9">201</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userDb <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> prismaClient.user.findUnique({
</span></span><span style="display:flex;"><span>      where<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>        email: <span style="color:#8be9fd">userData.email</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(userDb).toBeTruthy();
</span></span><span style="display:flex;"><span>    expect(userDb.email).toBe(userData.email);
</span></span><span style="display:flex;"><span>    expect(userDb.first_name).toBe(userData.first_name);
</span></span><span style="display:flex;"><span>    expect(userDb.last_name).toBe(userData.last_name);
</span></span><span style="display:flex;"><span>    expect(userDb.password).not.toBe(userData.password);
</span></span><span style="display:flex;"><span>    expect(userDb.created_at).toBeTruthy();
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Criamos um usuário usando nosso endpoint <code>[POST] /user</code> e depois buscamos no banco para garantir que o usuário foi salvo, rodando o teste com:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> npm run test:integration
</span></span></code></pre></div><p>Vamos ver que o teste passou:</p>
<p><img alt="project struct" src="/posts/teste-integracao-nestjs/Urtr22rg34hdfdfg534d.png"></p>
<p>Vamos fazer todos os testes, o foco não é mostrar cada teste, veja como ficou todos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>describe(<span style="color:#f1fa8c">&#39;[/user] POST&#39;</span>, () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  it(<span style="color:#f1fa8c">&#39;should create a user&#39;</span>, <span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userData: <span style="color:#8be9fd">UserDto</span> <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>      email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;john.doe@email.com&#39;</span>,
</span></span><span style="display:flex;"><span>      first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John&#39;</span>,
</span></span><span style="display:flex;"><span>      last_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Doe&#39;</span>,
</span></span><span style="display:flex;"><span>      password<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;password@1234&#39;</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> request(app.getHttpServer()).post(<span style="color:#f1fa8c">&#39;/user&#39;</span>).send(userData).expect(<span style="color:#bd93f9">201</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userDb <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> prismaClient.user.findUnique({
</span></span><span style="display:flex;"><span>      where<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>        email: <span style="color:#8be9fd">userData.email</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(userDb).toBeTruthy();
</span></span><span style="display:flex;"><span>    expect(userDb.email).toBe(userData.email);
</span></span><span style="display:flex;"><span>    expect(userDb.first_name).toBe(userData.first_name);
</span></span><span style="display:flex;"><span>    expect(userDb.last_name).toBe(userData.last_name);
</span></span><span style="display:flex;"><span>    expect(userDb.password).not.toBe(userData.password);
</span></span><span style="display:flex;"><span>    expect(userDb.created_at).toBeTruthy();
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  it(<span style="color:#f1fa8c">&#39;should not create a user with invalid data&#39;</span>, <span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userData: <span style="color:#8be9fd">UserDto</span> <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>      email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;john.doe@email.com&#39;</span>,
</span></span><span style="display:flex;"><span>      first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John&#39;</span>,
</span></span><span style="display:flex;"><span>      last_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Doe&#39;</span>,
</span></span><span style="display:flex;"><span>      password<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;password@1234&#39;</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> prismaClient.user.create({
</span></span><span style="display:flex;"><span>      data: <span style="color:#8be9fd">userData</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> response <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> request(app.getHttpServer())
</span></span><span style="display:flex;"><span>      .post(<span style="color:#f1fa8c">&#39;/user&#39;</span>)
</span></span><span style="display:flex;"><span>      .send(userData)
</span></span><span style="display:flex;"><span>      .expect(<span style="color:#bd93f9">400</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(response.body).toEqual({
</span></span><span style="display:flex;"><span>      statusCode: <span style="color:#8be9fd">400</span>,
</span></span><span style="display:flex;"><span>      message<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;user already exists&#39;</span>,
</span></span><span style="display:flex;"><span>      error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Bad Request&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  it(<span style="color:#f1fa8c">&#39;should be able to update user&#39;</span>, <span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userData: <span style="color:#8be9fd">UserDto</span> <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>      email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;john.doe@email.com&#39;</span>,
</span></span><span style="display:flex;"><span>      first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John&#39;</span>,
</span></span><span style="display:flex;"><span>      last_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Doe&#39;</span>,
</span></span><span style="display:flex;"><span>      password<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;password@1234&#39;</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userdb <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> prismaClient.user.create({
</span></span><span style="display:flex;"><span>      data: <span style="color:#8be9fd">userData</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> request(app.getHttpServer())
</span></span><span style="display:flex;"><span>      .patch(<span style="color:#f1fa8c">`/user/</span><span style="color:#f1fa8c">${</span>userdb.id<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>)
</span></span><span style="display:flex;"><span>      .send({
</span></span><span style="display:flex;"><span>        first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John Doe Updated&#39;</span>,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      .expect(<span style="color:#bd93f9">200</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userUpdated <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> prismaClient.user.findUnique({
</span></span><span style="display:flex;"><span>      where<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>        id: <span style="color:#8be9fd">userdb.id</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    expect(userUpdated.first_name).toBe(<span style="color:#f1fa8c">&#39;John Doe Updated&#39;</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  it(<span style="color:#f1fa8c">&#34;should not be able to update user that doesn&#39;t exist&#34;</span>, <span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> response <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> request(app.getHttpServer())
</span></span><span style="display:flex;"><span>      .patch(<span style="color:#f1fa8c">`/user/</span><span style="color:#f1fa8c">${</span>randomUUID()<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>)
</span></span><span style="display:flex;"><span>      .send({
</span></span><span style="display:flex;"><span>        first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John Doe Updated&#39;</span>,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      .expect(<span style="color:#bd93f9">404</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(response.body).toEqual({
</span></span><span style="display:flex;"><span>      statusCode: <span style="color:#8be9fd">404</span>,
</span></span><span style="display:flex;"><span>      message<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;user not found&#39;</span>,
</span></span><span style="display:flex;"><span>      error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Not Found&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  it(<span style="color:#f1fa8c">&#39;should not be able to update user with email already in use&#39;</span>, <span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userData: <span style="color:#8be9fd">UserDto</span> <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>      email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;john.doe@email.com&#39;</span>,
</span></span><span style="display:flex;"><span>      first_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;John&#39;</span>,
</span></span><span style="display:flex;"><span>      last_name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Doe&#39;</span>,
</span></span><span style="display:flex;"><span>      password<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;password@1234&#39;</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> userDb <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> prismaClient.user.create({
</span></span><span style="display:flex;"><span>      data: <span style="color:#8be9fd">userData</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> response <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> request(app.getHttpServer())
</span></span><span style="display:flex;"><span>      .patch(<span style="color:#f1fa8c">`/user/</span><span style="color:#f1fa8c">${</span>userDb.id<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>)
</span></span><span style="display:flex;"><span>      .send({
</span></span><span style="display:flex;"><span>        email: <span style="color:#8be9fd">userData.email</span>,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      .expect(<span style="color:#bd93f9">400</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(response.body).toEqual({
</span></span><span style="display:flex;"><span>      statusCode: <span style="color:#8be9fd">400</span>,
</span></span><span style="display:flex;"><span>      message<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;email already exists&#39;</span>,
</span></span><span style="display:flex;"><span>      error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;Bad Request&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Com isso temos nossa api com quase 100% de cobertura em teste de integração, garantindo seu funcionamento conforme o esperado e nos ajudando em futuras alterações.</p>
<h2 id="containers-genéricos">Containers Genéricos</h2>
<p>Você deve ter percebido que usamos o <code>PostgreSqlContainer</code> mas o testcontainers não oferece um container pronto para tudo, por isso temos os <code>GenericContainer</code>, com eles podemos passar qualquer imagem, por exemplo, se usarmos o <a href="https://postgis.net/">postgis</a> que é uma extensão do postgres para trabalhar com dados geoespaciais, o <code>PostgreSqlContainer</code> não resolveria, então usaríamos o <code>GenericContainer</code>:</p>
<p>Ficaria desta forma:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>beforeAll(<span style="color:#ff79c6">async</span> () <span style="color:#ff79c6">=&gt;</span> {
</span></span><span style="display:flex;"><span>  container <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> <span style="color:#ff79c6">new</span> GenericContainer(<span style="color:#f1fa8c">&#39;postgis/postgis:16-3.4:alpine&#39;</span>)
</span></span><span style="display:flex;"><span>    .withEnvironment({
</span></span><span style="display:flex;"><span>      POSTGRES_HOST: <span style="color:#8be9fd">dbHost</span>,
</span></span><span style="display:flex;"><span>      POSTGRES_PASSWORD: <span style="color:#8be9fd">dbPass</span>,
</span></span><span style="display:flex;"><span>      POSTGRES_USER: <span style="color:#8be9fd">dbUser</span>,
</span></span><span style="display:flex;"><span>      POSTGRES_DB: <span style="color:#8be9fd">dbName</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .withExposedPorts(dbPort)
</span></span><span style="display:flex;"><span>    .start();
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> mappedPort <span style="color:#ff79c6">=</span> container.getMappedPort(dbPort);
</span></span><span style="display:flex;"><span>  urlConnection <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">`postgresql://</span><span style="color:#f1fa8c">${</span>dbUser<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">${</span>dbPass<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">@</span><span style="color:#f1fa8c">${</span>dbHost<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">${</span>mappedPort<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/</span><span style="color:#f1fa8c">${</span>dbName<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>;
</span></span><span style="display:flex;"><span>  process.env.DATABASE_URL <span style="color:#ff79c6">=</span> urlConnection;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">//.. resto do codigo
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>});
</span></span></code></pre></div><p>Bem semelhante ao que fizemos, você pode criar <code>GenericContainer</code> de qualquer imagem, como elastic search, mongo, mysql.</p>
<h2 id="considerações-finais">Considerações finais</h2>
<p>Bom, este foi um pequeno post mostrando de forma simples como usar o poderoso <a href="https://testcontainers.com/">Testcontainers</a> com nestjs e prisma orm, essa foi uma maneira simples e rápida que encontrei de trabalhar com ele, existem diversas formas e abordagens, essa forma que encontrei deixaram meus testes um pouco mais rápidos e simples, os testes de integração tendem a ser mais demorados de executar e utilizando container isso pode aumentar ainda mais o tempo, apenas 5 casos de testes levaram cerca de 12 segundos, imagine centenas de testes.</p>
<h2 id="link-do-repositório">Link do repositório</h2>
<p><a href="https://github.com/wiliamvj/teste-integracao-Testecontainers">repositório</a> do projeto</p>
<p>Se inscreva e receba um aviso sobre novos posts, <a href="https://wiliamvj.substack.com/">participar</a></p>
</section>

  
    
  
    <div class="giscus-comment">
  <script
    src="https://giscus.app/client.js"
    data-repo="wiliamvj/wiliamvj.com"
    data-repo-id="R_kgDOKqMPTA"
    data-category="General"
    data-category-id="DIC_kwDOKqMPTM4CbzWf"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="noborder_dark"
    data-lang="en"
    
    data-loading="lazy"
    
    crossorigin="anonymous"
    async
  ></script>
</div>

  

    
  


  <footer>
    
  </footer>
</article>

</main><footer class="pt-5 pb-6 lg:grid lg:gap-3 lg:grid-cols-2">
  <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2024 —
  <a href="//localhost:1313/">Wiliam V. Joaquim</a>
  <span class="font-normal">with</span>
  <a
    href="https://github.com/nixentric/Lowkey-Hugo-Theme"
    target="_blank"
    rel="noopener noreferrer"
  >
    Lowkey
  </a>
</div>
 <div class="order-1 sm:order-2 f-social">
  <ul class="flex sm:justify-end gap-5">
     
    <li>
      <a href="https://www.linkedin.com/in/wiliamvj/" target="_blank" rel="noopener noreferrer"
        >linkedin</a
      >
    </li>
    
    <li>
      <a href="https://twitter.com/wiliamjoaquim" target="_blank" rel="noopener noreferrer"
        >x</a
      >
    </li>
    
    <li>
      <a href="https://github.com/wiliamvj" target="_blank" rel="noopener noreferrer"
        >github</a
      >
    </li>
    
    <li>
      <a href="https://dev.to/wiliamvj" target="_blank" rel="noopener noreferrer"
        >dev.to</a
      >
    </li>
     
  </ul>
</div>

</footer>

<button
  type="button"
  data-twe-ripple-init
  data-twe-ripple-color="light"
  class="!fixed bottom-5 end-5 hidden rounded-md bg-wpurple p-3 text-xs font-medium uppercase leading-tight text-white shadow-md transition duration-150 ease-in-out hover:bg-wpurplehover hover:shadow-lg focus:bg-wpurplehover focus:shadow-lg focus:outline-none focus:ring-0 active:bg-wpurple active:shadow-lg"
  id="btn-back-to-top"
>
  <span class="[&>svg]:w-4">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="3"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"
      />
    </svg>
  </span>
</button>

<script defer>
  const mybutton = document.getElementById('btn-back-to-top');
  const scrollFunction = () => {
    if (
      document.body.scrollTop > 20 ||
      document.documentElement.scrollTop > 20
    ) {
      mybutton.classList.remove('hidden');
    } else {
      mybutton.classList.add('hidden');
    }
  };
  const backToTop = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  mybutton.addEventListener('click', backToTop);
  window.addEventListener('scroll', scrollFunction);
</script>
</body>
</html>
