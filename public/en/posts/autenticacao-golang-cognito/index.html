<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>      

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Authentication with Golang and AWS Cognito</title>


<meta name="description" content="The authentication of an application is something very important in the system, but also very sensitive, there are various implementations, security, validation to be considered." />
<meta
  name="keywords"
  content="Golang, Go, GCP, Sql, Gorm, NestJS, Javascript, Typescript, AWS, SQS, RabbitMq, Kafka, microservices, brazilian devs, software developer, back-end, NodeJS, Unit tests, integration testes"
/>

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="//localhost:1313/en/posts/autenticacao-golang-cognito/" />
<meta name="twitter:title" content="Authentication with Golang and AWS Cognito" />
<meta name="twitter:description" content="The authentication of an application is something very important in the system, but also very sensitive, there are various implementations, security, validation to be considered." />
<meta name="twitter:image" content="//localhost:1313/posts/autenticacao-golang-cognito/thumb_esdhfkjhsd342DSF_en.png" />
<meta
  name="twitter:image:src"
  content="//localhost:1313/posts/autenticacao-golang-cognito/thumb_esdhfkjhsd342DSF_en.png"
/>
<meta name="twitter:domain" content="wiliamvj.com" />
<meta name="twitter:creator" content="@wiliamjoaquim" />
<meta name="twitter:image:alt" content="Authentication with Golang and AWS Cognito" />
<meta name="twitter:label1" content="Reading time"> <meta
name="twitter:data1" content="16 minutes read">
<meta name="twitter:app:name:iphone" content="wiliamvj" />

<meta property="og:type" content="article" />
<meta property="og:title" content="Authentication with Golang and AWS Cognito" />
<meta property="og:site_name" content="Wiliam V. Joaquim - Software Developer'" />
<meta property="og:description" content="The authentication of an application is something very important in the system, but also very sensitive, there are various implementations, security, validation to be considered." />
<meta property="og:url" content="//localhost:1313/en/posts/autenticacao-golang-cognito/" />
<meta property="og:image" content="//localhost:1313/posts/autenticacao-golang-cognito/thumb_esdhfkjhsd342DSF_en.png" />
<meta property="og:image:alt" content="Authentication with Golang and AWS Cognito" />


<meta
  name="apple-mobile-web-app-title"
  content="Authentication with Golang and AWS Cognito"
/>
<meta
  name="description"
  content="The authentication of an application is something very important in the system, but also very sensitive, there are various implementations, security, validation to be considered."
/>
<link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/icons/apple-touch.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/icons/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/icons/favicon-16x16.png"
/>
<link rel="canonical" href="//localhost:1313/en/posts/autenticacao-golang-cognito/" />
<link rel="robots" href="/robots.txt" />
<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />


<script
  defer
  src="https://www.googletagmanager.com/gtag/js?id=G-TG8KZ9PQBT"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'G-TG8KZ9PQBT');
</script>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="//localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto">
    <div class="header">
      <header
  class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 sm:py-12"
>
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="//localhost:1313/">
    <img
      srcset="/img/profile-picture_hu8648425526917772597.jpg 80w"
      src="/img/profile-picture.jpg"
      width="1467"
      height="1447"
      alt="Wiliam V. Joaquim"
    />
  </a>
</div>


  <div class="flex flex-col gap-5">
    <a href="//localhost:1313/">
  <h1 id="site-title">Wiliam V<span class="text-wpurple">.</span> Joaquim</h1>
</a>
 <nav>
  <ul class="px-4 lg:px-0">
     
    <li>
      <a
        href="/en"
        class=""
        
      >
        Posts
      </a>
      <span class="text-wpurple text-lg">.</span>
    </li>
    
    <li>
      <a
        href="https://wiliamvj.substack.com/"
        class=""
         target="_blank" 
      >
        Newsletter
      </a>
      <span class="text-wpurple text-lg">.</span>
    </li>
    
    <li>
      <a
        href="/"
        class=""
        
      >
        pt-BR
      </a>
      <span class="text-wpurple text-lg">.</span>
    </li>
    
    <li class="-mt-2 block lg:hidden"><button
  class="toggle-theme"
  aria-label="Toggle Theme"
  title="Toggle Theme"
  onclick="toggleTheme()"
>
  <span class="theme-icon light hidden dark:block">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>
  </span>
  <span class="theme-icon dark block dark:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>
  </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');
    setTheme(theme);
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      html.classList.remove('dark');
      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      html.classList.add('dark');
      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');
    const newTheme = theme === 'light' ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    setTheme(newTheme);
    reloadGiscus(newTheme);
  }
</script>


<script>
  function reloadGiscus(theme) {
    const existingGiscusScript = document.getElementById('giscus-script');
    if (existingGiscusScript) existingGiscusScript.remove();

    let giscusScript = document.createElement('script');
    const giscusTheme = theme === 'light' ? 'noborder_light' : 'noborder_dark';

    let giscusAttributes = {
      id: 'giscus-script',
      src: 'https://giscus.app/client.js',
      'data-repo': 'wiliamvj\/wiliamvj.com',
      'data-repo-id': 'R_kgDOLkkfgA',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOLkkfgM4CeL5M',
      'data-mapping': 'title',
      'data-strict': '0',
      'data-reactions-enabled':
        '1',
      'data-emit-metadata':
        '0',
      'data-input-position':
        'top',
      'data-theme': giscusTheme,
      'data-lang': 'pt',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: '',
    };

    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.body.appendChild(giscusScript);
  }
</script>

</li>
  </ul>
</nav>

  </div>
</header>

      <div class="lg:inline-block hidden">
        <button
  class="toggle-theme"
  aria-label="Toggle Theme"
  title="Toggle Theme"
  onclick="toggleTheme()"
>
  <span class="theme-icon light hidden dark:block">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>
  </span>
  <span class="theme-icon dark block dark:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>
  </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');
    setTheme(theme);
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      html.classList.remove('dark');
      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      html.classList.add('dark');
      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');
    const newTheme = theme === 'light' ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    setTheme(newTheme);
    reloadGiscus(newTheme);
  }
</script>


<script>
  function reloadGiscus(theme) {
    const existingGiscusScript = document.getElementById('giscus-script');
    if (existingGiscusScript) existingGiscusScript.remove();

    let giscusScript = document.createElement('script');
    const giscusTheme = theme === 'light' ? 'noborder_light' : 'noborder_dark';

    let giscusAttributes = {
      id: 'giscus-script',
      src: 'https://giscus.app/client.js',
      'data-repo': 'wiliamvj\/wiliamvj.com',
      'data-repo-id': 'R_kgDOLkkfgA',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOLkkfgM4CeL5M',
      'data-mapping': 'title',
      'data-strict': '0',
      'data-reactions-enabled':
        '1',
      'data-emit-metadata':
        '0',
      'data-input-position':
        'top',
      'data-theme': giscusTheme,
      'data-lang': 'pt',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: '',
    };

    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.body.appendChild(giscusScript);
  }
</script>


      </div>
    </div>

    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-small">Authentication with Golang and AWS Cognito</h2>

    <div class="meta">
      
      <time
        datetime="2024-02-07 19:03:34 -0300 -03"
        title='Wed, Feb 7, 2024, 7:03 PM -03'
      >
        Published in: 07/02/2024 - 16 minutes read
      </time>

       
    </div>
  </header>

  


  <section><p><img alt="thumbnail" src="/posts/autenticacao-golang-cognito/thumb_esdhfkjhsd342DSF_en.png"></p>
<h2 id="what-is-cognito">What is cognito?</h2>
<p>The authentication of an application is something very important in the system, but also very sensitive, there are various implementations, security, validation to be considered.</p>
<p>I decided to make a post demonstrating a about <a href="https://aws.amazon.com/pt/pm/cognito/">Cognito</a>, a very nice tool from AWS that can help you in the authentication and validation of the user for Web and mobile applications that many people do not know.</p>
<p>Cognito is an AWS platform responsible for creating and validating user access data, as well as being able to register users and store their information, in addition to generating OAuth tokens, and Cognito can also provide all user validation.</p>
<p>We can create some user data such as: email, name, phone, birthdate, nickname, gender, website and many others, we can also place custom fields.</p>
<p>Cognito still allows us to work with &ldquo;federated providers&rdquo;, known as social logins, such as Google, Facebook and GitHub, we are not going to address this post, but it is possible to do it with cognito.</p>
<h2 id="what-are-we-going-to-do">What are we going to do?</h2>
<p>We are going to make some endpoints to show how cognito works, we are going to create a user, confirm email, login, search for a user using the token provided by cognito, update information.</p>
<h2 id="setting-up-the-project">Setting up the project</h2>
<p>We are going to do something very simple, we are not going to worry about the project father, we want to address only the use of knowledge.</p>
<p>To create the endpoints we are going to use <a href="https://github.com/gin-gonic/gin">gin</a>.</p>
<p>Let&rsquo;s create the following files:</p>
<ul>
<li>
<p>The entrypoint of our application <code>main.go</code> at the root of the project</p>
</li>
<li>
<p><code>.env</code> To save cognitive credentials</p>
</li>
<li>
<p>A paste called <strong>cognitoClient</strong> and inside a file called <code>cognito.go</code></p>
</li>
<li>
<p>There is a file called <code>request.http</code>, to complete your requests.</p>
</li>
</ul>
<p>The structure will be as follows:</p>
<p><img alt="project struct" src="/posts/autenticacao-golang-cognito/DfpSdfoasfsdf435fdg435f.png"></p>
<h2 id="setting-up-cognito-on-aws">Setting up Cognito on AWS</h2>
<p>Before starting the code, we will configure the cognito in AWS, to access the panel and search by cognito, after we will create our pool, select the option <strong>Add user directories to your app</strong>.</p>
<p>For <strong>Provider types</strong>, select the <strong>Cognito user pool</strong> option, you can choose to allow login using email, user name and phone, you can only opt for email, select what you prefer, select assim to first stage:</p>
<p><img alt="cognito configuration step 1" src="/posts/autenticacao-golang-cognito/sdffghj456FG234fdgdsgdfgDfg.png"></p>
<p>I need to configure some more things, let&rsquo;s go!</p>
<ul>
<li><strong>Password policy mode</strong> allows you to select a specific policy, let&rsquo;s deixar the <strong>Cognito defaults</strong>.</li>
<li><strong>Multi-factor authentication</strong> allows our login to have two-factor authentication, let&rsquo;s go without, but you can implement it if desired, you can opt for <strong>No MFA</strong>.</li>
<li>Finally, or <strong>User account recovery</strong>, you can choose ways to recover your account, you can just choose email.</li>
</ul>
<p><img alt="cognito configuration step 2.1" src="/posts/autenticacao-golang-cognito/sdf5fghfghf-part-1.png"></p>
<p><img alt="cognito configuration step 2.2" src="/posts/autenticacao-golang-cognito/ssdf798HGJdfg-part-2.png"></p>
<p>Next step:</p>
<ul>
<li><strong>Self-service sign-up</strong>, we will allow any person to do so, leave selected.</li>
<li><strong>Cognito-assisted verification and confirmation</strong>, allow cognito to be responsible for confirming the user&rsquo;s identity, check it, and also select the option <strong>Send email message, verify email address</strong>.</li>
<li><strong>Verifying attribute changes</strong>, check this option, so that updating the user&rsquo;s email needs to be validated again.</li>
<li><strong>Required attributes</strong>, select the fields that you want to make mandatory to create a new user, you will select the options, email (and the name) and the name will also be required by your father.</li>
<li><strong>Custom attributes</strong>, it is optional, but you can add custom fields, for example, you will create a field called <code>custom_id</code> which will be any <code>uuid</code>.</li>
</ul>
<p>This stage also occurred:</p>
<p><img alt="cognito configuration step 2.3" src="/posts/autenticacao-golang-cognito/sdfsdfsdfsdfsdhfgYT4-part-1.png"></p>
<p><img alt="cognito configuration step 2.4" src="/posts/autenticacao-golang-cognito/sdfsdfsdfsdfsdhfgYT4-part-2.png"></p>
<p><img alt="cognito configuration step 2.5" src="/posts/autenticacao-golang-cognito/sdfsdfsdfsdfsdhfgYT4-part-3.png"></p>
<p>Next, select the <strong>Send email with Cognito</strong> option, so we do not need to configure anything to trigger the emails.</p>
<p>In the next step, in <strong>User pool name</strong> put the name you want in <strong>App client name</strong>, also put the name you want and continue.</p>
<p>In the last stage we will not need to alter anything, just finish and create the user pool.</p>
<p>With everything, access or cognito &gt; User pools, select the pool that you just created, this part will list all the users of your application, and it is possible to revoke the user&rsquo;s token, deactivate, verify among other functionalities.</p>
<p>We are going to specify the id of the pool, to be able to use the <a href="https://aws.amazon.com/pt/developer/tools/">Go sdk</a> for aws, for access to the created pool <strong>App integration</strong> &gt; <strong>App client list</strong> and see our <strong>Client ID</strong>:</p>
<p><img alt="cognito client id" src="/posts/autenticacao-golang-cognito/asdfgh567Hfh.png"></p>
<p>Let&rsquo;s save this id in our <code>.env</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>COGNITO_CLIENT_ID=client_id
</span></span></code></pre></div><p>Remembering that you still need to have the AWS credentials, usually located in the <code>/Users/your-user/.aws</code> directory, if you haven&rsquo;t configured it yet, see <a href="https://docs.aws.amazon.com/pt_br/cli/latest/userguide/cli-chap-configure.html">here</a> how to do it.</p>
<h2 id="implementing-cognito">Implementing cognito</h2>
<p>Let&rsquo;s separate the cognito part into another file.</p>
<h3 id="registering-the-user">Registering the user</h3>
<p>Inside the <code>cognito.go</code> file, we will initialize our cognito and create our interface:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#ff79c6">package</span> congnitoClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;github.com/aws/aws-sdk-go/aws&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;github.com/aws/aws-sdk-go/aws/session&#34;</span>
</span></span><span style="display:flex;"><span>    cognito <span style="color:#f1fa8c">&#34;github.com/aws/aws-sdk-go/service/cognitoidentityprovider&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;github.com/google/uuid&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> User <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    Name     <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;name&#34; binding:&#34;required&#34;`</span>
</span></span><span style="display:flex;"><span>    Email    <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;email&#34; binding:&#34;required,email&#34;`</span>
</span></span><span style="display:flex;"><span>    Password <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;password&#34; binding:&#34;required&#34;`</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> CognitoInterface <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> cognitoClient <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    cognitoClient <span style="color:#ff79c6">*</span>cognito.CognitoIdentityProvider
</span></span><span style="display:flex;"><span>    appClientID   <span style="color:#8be9fd">string</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">NewCognitoClient</span>(appClientId <span style="color:#8be9fd">string</span>) CognitoInterface {
</span></span><span style="display:flex;"><span>    config <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>aws.Config{Region: aws.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;us-east-1&#34;</span>)}
</span></span><span style="display:flex;"><span>    sess, err <span style="color:#ff79c6">:=</span> session.<span style="color:#50fa7b">NewSession</span>(config)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    client <span style="color:#ff79c6">:=</span> cognito.<span style="color:#50fa7b">New</span>(sess)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">&amp;</span>cognitoClient{
</span></span><span style="display:flex;"><span>      cognitoClient: client,
</span></span><span style="display:flex;"><span>      appClientID:   appClientId,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> (c <span style="color:#ff79c6">*</span>cognitoClient) <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>First we create a struct called <code>User</code>, this struct will have the user fields that we need to save in cognito.</p>
<p>Then we create an <code>interface</code> called <code>CognitoInterface</code>, we will have the methods that we will use, first we will only have <code>SignUp</code> which will receive a pointer to the <code>User</code> struct.</p>
<p>Then we will have another struct called <code>cognitoClient</code> that will contain our instance for <code>NewCognitoClient</code> that will be our constructor.</p>
<p>As mentioned, <code>NewCognitoClient</code> will be like our constructor, it is where we will create the session with AWS and return this connection. This connection could be a global variable, in our case we will not do this, it is up to you to check which is the best approach for your use case.</p>
<p>Now let&rsquo;s implement <code>SignUp</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> (c <span style="color:#ff79c6">*</span>cognitoClient) <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    userCognito <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>cognito.SignUpInput{
</span></span><span style="display:flex;"><span>      ClientId: aws.<span style="color:#50fa7b">String</span>(c.appClientID),
</span></span><span style="display:flex;"><span>      Username: aws.<span style="color:#50fa7b">String</span>(user.Email),
</span></span><span style="display:flex;"><span>      Password: aws.<span style="color:#50fa7b">String</span>(user.Password),
</span></span><span style="display:flex;"><span>      UserAttributes: []<span style="color:#ff79c6">*</span>cognito.AttributeType{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          Name:  aws.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;name&#34;</span>),
</span></span><span style="display:flex;"><span>          Value: aws.<span style="color:#50fa7b">String</span>(user.Name),
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          Name:  aws.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;email&#34;</span>),
</span></span><span style="display:flex;"><span>          Value: aws.<span style="color:#50fa7b">String</span>(user.Email),
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          Name:  aws.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;custom:custom_id&#34;</span>),
</span></span><span style="display:flex;"><span>          Value: aws.<span style="color:#50fa7b">String</span>(uuid.<span style="color:#50fa7b">NewString</span>()),
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _, err <span style="color:#ff79c6">:=</span> c.cognitoClient.<span style="color:#50fa7b">SignUp</span>(userCognito)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>We will use the <code>AttributeType</code> from Cognito to assemble the parameters that we will send to the <code>SignUp</code> of the AWS SDK, note that the <code>custom_id</code> which is our custom field, needs to be placed <code>custom</code> before, without this it will not be accepted, we just created a uuid with the Google package, this field is just to show how to use custom attributes.</p>
<p>The <code>ClientId</code> field refers to the <code>COGNITO_CLIENT_ID</code> of our env, we will pass it on when starting <code>main.go</code>.</p>
<p>This is what we need to save the user, simple isn&rsquo;t it?</p>
<p>Don&rsquo;t forget to start the project with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  go mod init &lt;your project name&gt;
</span></span></code></pre></div><p>And install the necessary packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  go mod tidy
</span></span></code></pre></div><h3 id="confirming-the-account">Confirming the account</h3>
<p>Let&rsquo;s create another function to verify the user&rsquo;s account via email. To verify the account, the user will need to enter the code sent by email. Let&rsquo;s create a new struct and add the new <code>ConfirmAccount</code> method to the interface:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> UserConfirmation <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    Email <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;email&#34; binding:&#34;required,email&#34;`</span>
</span></span><span style="display:flex;"><span>    Code  <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;code&#34; binding:&#34;required&#34;`</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> CognitoInterface <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">ConfirmAccount</span>(user <span style="color:#ff79c6">*</span>UserConfirmation) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Now let&rsquo;s implement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> (c <span style="color:#ff79c6">*</span>cognitoClient) <span style="color:#50fa7b">ConfirmAccount</span>(user <span style="color:#ff79c6">*</span>UserConfirmation) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    confirmationInput <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>cognito.ConfirmSignUpInput{
</span></span><span style="display:flex;"><span>      Username:         aws.<span style="color:#50fa7b">String</span>(user.Email),
</span></span><span style="display:flex;"><span>      ConfirmationCode: aws.<span style="color:#50fa7b">String</span>(user.Code),
</span></span><span style="display:flex;"><span>      ClientId:         aws.<span style="color:#50fa7b">String</span>(c.appClientID),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _, err <span style="color:#ff79c6">:=</span> c.cognitoClient.<span style="color:#50fa7b">ConfirmSignUp</span>(confirmationInput)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>It&rsquo;s very simple, we will use the <code>ConfirmSignUpInput</code> from the cognito package to assemble the parameters, remembering that the <code>Username</code> is the user&rsquo;s email. Finally, we will call <code>ConfirmSignUp</code> passing the <code>confirmationInput</code>.</p>
<p>Remembering that we only returned the error, you could improve and check the types of error messages.</p>
<h3 id="login">Login</h3>
<p>This should be the functionality that will be used the most, let&rsquo;s create a method called <code>SignIn</code> and a struct:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> UserLogin <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    Email    <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;email&#34; binding:&#34;required,email&#34;`</span>
</span></span><span style="display:flex;"><span>    Password <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;password&#34; binding:&#34;required&#34;`</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> CognitoInterface <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">ConfirmAccount</span>(user <span style="color:#ff79c6">*</span>UserConfirmation) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignIn</span>(user <span style="color:#ff79c6">*</span>UserLogin) (<span style="color:#8be9fd">string</span>, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Our <code>SignIn</code> will receive a <code>UserLogin</code>.</p>
<p>Let&rsquo;s implement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> (c <span style="color:#ff79c6">*</span>cognitoClient) <span style="color:#50fa7b">SignIn</span>(user <span style="color:#ff79c6">*</span>UserLogin) (<span style="color:#8be9fd">string</span>, <span style="color:#8be9fd">error</span>) {
</span></span><span style="display:flex;"><span>    authInput <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>cognito.InitiateAuthInput{
</span></span><span style="display:flex;"><span>      AuthFlow: aws.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;USER_PASSWORD_AUTH&#34;</span>),
</span></span><span style="display:flex;"><span>      AuthParameters: aws.<span style="color:#50fa7b">StringMap</span>(<span style="color:#8be9fd;font-style:italic">map</span>[<span style="color:#8be9fd">string</span>]<span style="color:#8be9fd">string</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;USERNAME&#34;</span>: user.Email,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;PASSWORD&#34;</span>: user.Password,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>      ClientId: aws.<span style="color:#50fa7b">String</span>(c.appClientID),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result, err <span style="color:#ff79c6">:=</span> c.cognitoClient.<span style="color:#50fa7b">InitiateAuth</span>(authInput)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;&#34;</span>, err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">*</span>result.AuthenticationResult.AccessToken, <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>We will use the <code>InitiateAuth</code> function from the aws cognito package, we need to pass the <code>username</code> (user&rsquo;s email), <code>password</code> and the <code>AuthFlow</code>, this field refers to the type of access that we will allow, in our case <code>USER_PASSWORD_AUTH</code>.</p>
<blockquote>
<p>If you receive an error like this:</p>
</blockquote>
<blockquote>
<p><code>You trusted all proxies, this is NOT safe. We recommend you to set a value</code></p>
</blockquote>
<p>It will be necessary to enable the <code>ALLOW_USER_PASSWORD_AUTH</code> flow, to configure it access cognito on the aws panel, go to:</p>
<p><strong>User pools</strong> &gt; <strong>Selecione seu pool</strong> &gt; <strong>App integration</strong> &gt; <strong>App client list</strong> &gt; <strong>Selecione um client</strong>, will open this screen:</p>
<p><img alt="cognito flow 1" src="/posts/autenticacao-golang-cognito/sdfbfg78F34dfg.png"></p>
<p>Click on <strong>edit</strong> and in <strong>Authentication flows</strong> select the option <strong>ALLOW_USER_PASSWORD_AUTH</strong> then save, with this you can now log in with the user&rsquo;s password and email.</p>
<h3 id="listando-um-usuário">Listando um usuário</h3>
<p>Para mostrar como utilizar o token jwt fornecido pelo cognito vamos criar um endpoint que mostra os dados do usuário salvos no cognito apenas com o token.</p>
<p>Let&rsquo;s create another function called <code>GetUserByToken</code> that will receive a token and return a struct of type <code>GetUserOutput</code> that we will get from the cognito package.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> CognitoInterface <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">ConfirmAccount</span>(user <span style="color:#ff79c6">*</span>UserConfirmation) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignIn</span>(user <span style="color:#ff79c6">*</span>UserLogin) (<span style="color:#8be9fd">string</span>, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">GetUserByToken</span>(token <span style="color:#8be9fd">string</span>) (<span style="color:#ff79c6">*</span>cognito.GetUserOutput, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>If you click on <code>GetUserOutput</code> you will see what is inside this struct</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> GetUserOutput <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    _ <span style="color:#8be9fd;font-style:italic">struct</span>{} <span style="color:#f1fa8c">`type:&#34;structure&#34;`</span>
</span></span><span style="display:flex;"><span>    MFAOptions []<span style="color:#ff79c6">*</span>MFAOptionType <span style="color:#f1fa8c">`type:&#34;list&#34;`</span>
</span></span><span style="display:flex;"><span>    PreferredMfaSetting <span style="color:#ff79c6">*</span><span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`type:&#34;string&#34;`</span>
</span></span><span style="display:flex;"><span>    UserAttributes []<span style="color:#ff79c6">*</span>AttributeType <span style="color:#f1fa8c">`type:&#34;list&#34; required:&#34;true&#34;`</span>
</span></span><span style="display:flex;"><span>    UserMFASettingList []<span style="color:#ff79c6">*</span><span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`type:&#34;list&#34;`</span>
</span></span><span style="display:flex;"><span>    Username <span style="color:#ff79c6">*</span><span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`min:&#34;1&#34; type:&#34;string&#34; required:&#34;true&#34; sensitive:&#34;true&#34;`</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>inside the <code>_ struct{}</code> there are custom attributes that we created for our user, in our case the <code>custom_id</code>.</p>
<p>Let&rsquo;s implement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> (c <span style="color:#ff79c6">*</span>cognitoClient) <span style="color:#50fa7b">GetUserByToken</span>(token <span style="color:#8be9fd">string</span>) (<span style="color:#ff79c6">*</span>cognito.GetUserOutput, <span style="color:#8be9fd">error</span>) {
</span></span><span style="display:flex;"><span>    input <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>cognito.GetUserInput{
</span></span><span style="display:flex;"><span>      AccessToken: aws.<span style="color:#50fa7b">String</span>(token),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result, err <span style="color:#ff79c6">:=</span> c.cognitoClient.<span style="color:#50fa7b">GetUser</span>(input)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>, err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result, <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>We use <code>GetUser</code> from the cognito package, it only needs an <code>AccessToken</code> which is the token provided by cognito itself.</p>
<h3 id="updating-password">Updating password</h3>
<p>Finally, we will update the user&rsquo;s password. To do this, we will need the email address and the new password. We already have the <code>UserLogin</code> struct with the fields we need. We will reuse it. If you wish, create a new one just for this function. Let&rsquo;s create the <code>UpdatePassword</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> CognitoInterface <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignUp</span>(user <span style="color:#ff79c6">*</span>User) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">ConfirmAccount</span>(user <span style="color:#ff79c6">*</span>UserConfirmation) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">SignIn</span>(user <span style="color:#ff79c6">*</span>UserLogin) (<span style="color:#8be9fd">string</span>, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">GetUserByToken</span>(token <span style="color:#8be9fd">string</span>) (<span style="color:#ff79c6">*</span>cognito.GetUserOutput, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">UpdatePassword</span>(user <span style="color:#ff79c6">*</span>UserLogin) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Let&rsquo;s implement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> (c <span style="color:#ff79c6">*</span>cognitoClient) <span style="color:#50fa7b">UpdatePassword</span>(user <span style="color:#ff79c6">*</span>UserLogin) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    input <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>cognito.AdminSetUserPasswordInput{
</span></span><span style="display:flex;"><span>      UserPoolId: aws.<span style="color:#50fa7b">String</span>(os.<span style="color:#50fa7b">Getenv</span>(<span style="color:#f1fa8c">&#34;COGNITO_USER_POOL_ID&#34;</span>)),
</span></span><span style="display:flex;"><span>      Username:   aws.<span style="color:#50fa7b">String</span>(user.Email),
</span></span><span style="display:flex;"><span>      Password:   aws.<span style="color:#50fa7b">String</span>(user.Password),
</span></span><span style="display:flex;"><span>      Permanent:  aws.<span style="color:#50fa7b">Bool</span>(<span style="color:#ff79c6">true</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _, err <span style="color:#ff79c6">:=</span> c.cognitoClient.<span style="color:#50fa7b">AdminSetUserPassword</span>(input)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>We will use the <code>AdminSetUserPassword</code> function from the cognito package, we need to pass the user&rsquo;s email and the new password, in addition we have to pass the <code>UserPoolId</code>, we will put the <code>COGNITO_USER_POOL_ID</code> in the <code>.env</code> file, to search in aws just access your pool and copy the <code>User pool ID</code></p>
<p><img alt="pool id" src="/posts/autenticacao-golang-cognito/sdfsdf345FGfgh567.png"></p>
<p>We will also pass <code>Permanent</code>, informing that it is a permanent password, you could pass <code>false</code>, so Cognito would create a temporary password for the user, this will depend on the strategy you will use in your application.</p>
<h2 id="creating-the-main">Creating the main</h2>
<p>Let&rsquo;s create our <code>main.go</code>, this will be the file where we will start cognito and create our routes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    err <span style="color:#ff79c6">:=</span> godotenv.<span style="color:#50fa7b">Load</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    cognitoClient <span style="color:#ff79c6">:=</span> congnitoClient.<span style="color:#50fa7b">NewCognitoClient</span>(os.<span style="color:#50fa7b">Getenv</span>(<span style="color:#f1fa8c">&#34;COGNITO_CLIENT_ID&#34;</span>))
</span></span><span style="display:flex;"><span>    r <span style="color:#ff79c6">:=</span> gin.<span style="color:#50fa7b">Default</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    fmt.<span style="color:#50fa7b">Println</span>(<span style="color:#f1fa8c">&#34;Server is running on port 8080&#34;</span>)
</span></span><span style="display:flex;"><span>    err = r.<span style="color:#50fa7b">Run</span>(<span style="color:#f1fa8c">&#34;:8080&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>First we will load our envs with the <a href="https://github.com/joho/godotenv">godotenv</a> package, then we start our cognito client, passing the <code>COGNITO_CLIENT_ID</code>, which we got earlier, then we start gin and create a server, that&rsquo;s enough.</p>
<h2 id="creating-the-endpoints">Creating the endpoints</h2>
<h3 id="creating-a-user">Creating a user</h3>
<p>Let&rsquo;s create a function inside the <code>main.go</code> file itself, let&rsquo;s call it <code>CreateUser</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">CreateUser</span>(c <span style="color:#ff79c6">*</span>gin.Context, cognito congnitoClient.CognitoInterface) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">var</span> user congnitoClient.User
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> c.<span style="color:#50fa7b">ShouldBindJSON</span>(<span style="color:#ff79c6">&amp;</span>user); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;invalid json&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    err <span style="color:#ff79c6">:=</span> cognito.<span style="color:#50fa7b">SignUp</span>(<span style="color:#ff79c6">&amp;</span>user)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;could not create use&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Something simple, we just convert what we receive in the body to our struct using gin&rsquo;s <code>ShouldBindJSON</code>, then we call the <code>SignUp</code> that we created in <code>cognito.go</code>.</p>
<p>Now let&rsquo;s create the endpoint inside the <code>main.go</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  r.<span style="color:#50fa7b">POST</span>(<span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#8be9fd;font-style:italic">func</span>(context <span style="color:#ff79c6">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>		err <span style="color:#ff79c6">:=</span> <span style="color:#50fa7b">CreateUser</span>(context, cognitoClient)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			context.<span style="color:#50fa7b">JSON</span>(http.StatusBadRequest, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: err.<span style="color:#50fa7b">Error</span>()})
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		context.<span style="color:#50fa7b">JSON</span>(http.StatusCreated, gin.H{<span style="color:#f1fa8c">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;user created&#34;</span>})
</span></span><span style="display:flex;"><span>	})
</span></span></code></pre></div><p>We call the function we just created <code>CreateUser</code>, if there is an error we throw a <code>StatusBadRequest</code>, if it is successful a <code>StatusCreated</code>, let&rsquo;s test.</p>
<p>Let&rsquo;s do a <code>go mod tidy</code> downloading all the packages, then we&rsquo;ll run the application with <code>go run main.go</code></p>
<p>Now we can create a call in the <code>request.http</code> file and execute:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#50fa7b">POST</span> http://localhost:8080/user <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
</span></span><span style="display:flex;"><span>content-type<span style="color:#ff79c6">:</span> application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;Name&#34;</span>: <span style="color:#f1fa8c">&#34;John Doe&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;wivobi1159@bitofee.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;password&#34;</span>: <span style="color:#f1fa8c">&#34;Pass@1234&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If everything is correct we will receive the message:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;user created&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now entering the Cognito panel on AWS, and accessing the pool then the users, we will have our user there:</p>
<p><img alt="user" src="/posts/autenticacao-golang-cognito/dfsdhjkdfgsdf78yui.png"></p>
<h3 id="confirming-a-user">Confirming a user</h3>
<p>Note that the user we created above is not confirmed, let&rsquo;s confirm it!</p>
<p>Create a function called <code>ConfirmAccount</code> in the <code>main.go</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">ConfirmAccount</span>(c <span style="color:#ff79c6">*</span>gin.Context, cognito congnitoClient.CognitoInterface) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">var</span> user congnitoClient.UserConfirmation
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> c.<span style="color:#50fa7b">ShouldBindJSON</span>(<span style="color:#ff79c6">&amp;</span>user); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;invalid json&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    err <span style="color:#ff79c6">:=</span> cognito.<span style="color:#50fa7b">ConfirmAccount</span>(<span style="color:#ff79c6">&amp;</span>user)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;could not confirm user&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Same concept we used before, let&rsquo;s convert the body to the <code>UserConfirmation</code> struct and pass it to <code>ConfirmAccount</code> in <code>cognito.go</code>.</p>
<p>Let&rsquo;s create the endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  r.<span style="color:#50fa7b">POST</span>(<span style="color:#f1fa8c">&#34;user/confirmation&#34;</span>, <span style="color:#8be9fd;font-style:italic">func</span>(context <span style="color:#ff79c6">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>		err <span style="color:#ff79c6">:=</span> <span style="color:#50fa7b">ConfirmAccount</span>(context, cognitoClient)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			context.<span style="color:#50fa7b">JSON</span>(http.StatusBadRequest, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: err.<span style="color:#50fa7b">Error</span>()})
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		context.<span style="color:#50fa7b">JSON</span>(http.StatusCreated, gin.H{<span style="color:#f1fa8c">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;user confirmed&#34;</span>})
</span></span><span style="display:flex;"><span>	})
</span></span></code></pre></div><p>It&rsquo;s also simple, we just handle the error and return a message, let&rsquo;s create our call and test it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#50fa7b">POST</span> http://localhost:8080/user/confirmation <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
</span></span><span style="display:flex;"><span>content-type<span style="color:#ff79c6">:</span> application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;wivobi1159@bitofee.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;code&#34;</span>: <span style="color:#f1fa8c">&#34;363284&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We will receive the message:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;user confirmed&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now accessing Cognito again on the AWS panel, notice that the user is confirmed, remembering that you need to enter a valid email, you can use a temporary email to play around, but it needs to be valid, as Cognito will send the confirmation code and it needs to be a valid code to confirm successfully.</p>
<p><img alt="user confirmed" src="/posts/autenticacao-golang-cognito/sdfsdfpoiwoue234546GHw3FDG.png"></p>
<h3 id="login-1">Login</h3>
<p>Now let&rsquo;s create our token, to do this in the <code>main.go</code> file create a function called <code>SignIn</code>, this function will return an error and a token.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">SignIn</span>(c <span style="color:#ff79c6">*</span>gin.Context, cognito congnitoClient.CognitoInterface) (<span style="color:#8be9fd">string</span>, <span style="color:#8be9fd">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">var</span> user congnitoClient.UserLogin
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> c.<span style="color:#50fa7b">ShouldBindJSON</span>(<span style="color:#ff79c6">&amp;</span>user); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;&#34;</span>, errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;invalid json&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    token, err <span style="color:#ff79c6">:=</span> cognito.<span style="color:#50fa7b">SignIn</span>(<span style="color:#ff79c6">&amp;</span>user)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;&#34;</span>, errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;could not sign in&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> token, <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Same pattern as the other functions, we convert the body to the <code>UserLogin</code> struct and pass it to <code>SignIn</code> of <code>cognito.go</code>.</p>
<p>Let&rsquo;s create the endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  r.<span style="color:#50fa7b">POST</span>(<span style="color:#f1fa8c">&#34;user/login&#34;</span>, <span style="color:#8be9fd;font-style:italic">func</span>(context <span style="color:#ff79c6">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>		token, err <span style="color:#ff79c6">:=</span> <span style="color:#50fa7b">SignIn</span>(context, cognitoClient)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			context.<span style="color:#50fa7b">JSON</span>(http.StatusBadRequest, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: err.<span style="color:#50fa7b">Error</span>()})
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		context.<span style="color:#50fa7b">JSON</span>(http.StatusCreated, gin.H{<span style="color:#f1fa8c">&#34;token&#34;</span>: token})
</span></span><span style="display:flex;"><span>	})
</span></span></code></pre></div><p>Now we return a <code>token</code> to the user, let&rsquo;s create the call and test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#50fa7b">POST</span> http://localhost:8080/user/login <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
</span></span><span style="display:flex;"><span>content-type<span style="color:#ff79c6">:</span> application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;wivobi1159@bitofee.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;password&#34;</span>: <span style="color:#f1fa8c">&#34;Pass@1234&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When making the call we will receive our jwt token:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;token_here&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img alt="user jwt token" src="/posts/autenticacao-golang-cognito/token_dfgdfg765Kas23.png"></p>
<p>If we get the jwt token we can see what&rsquo;s inside, using the website <a href="https://jwt.io/">jwt.io</a>.</p>
<h3 id="listing-a-user">Listing a user</h3>
<p>Now we will list the user data saved in cognito using only the token, to do this create a function called <code>GetUserByToken</code> in <code>main.go</code> and we will need a struct to represent the response that we will return to the user, we will create it in <code>main</code> as well:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">type</span> UserResponse <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    ID            <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;id&#34;`</span>
</span></span><span style="display:flex;"><span>    Name          <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>    Email         <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;email&#34;`</span>
</span></span><span style="display:flex;"><span>    CustomID      <span style="color:#8be9fd">string</span> <span style="color:#f1fa8c">`json:&#34;custom_id&#34;`</span>
</span></span><span style="display:flex;"><span>    EmailVerified <span style="color:#8be9fd">bool</span>   <span style="color:#f1fa8c">`json:&#34;email_verified&#34;`</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {}
</span></span></code></pre></div><p>Now the function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">GetUserByToken</span>(c <span style="color:#ff79c6">*</span>gin.Context, cognito congnitoClient.CognitoInterface) (<span style="color:#ff79c6">*</span>UserResponse, <span style="color:#8be9fd">error</span>) {
</span></span><span style="display:flex;"><span>    token <span style="color:#ff79c6">:=</span> strings.<span style="color:#50fa7b">TrimPrefix</span>(c.<span style="color:#50fa7b">GetHeader</span>(<span style="color:#f1fa8c">&#34;Authorization&#34;</span>), <span style="color:#f1fa8c">&#34;Bearer &#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> token <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>, errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;token not found&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    cognitoUser, err <span style="color:#ff79c6">:=</span> cognito.<span style="color:#50fa7b">GetUserByToken</span>(token)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>, errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;could not get user&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    user <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">&amp;</span>UserResponse{}
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> _, attribute <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">range</span> cognitoUser.UserAttributes {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">switch</span> <span style="color:#ff79c6">*</span>attribute.Name {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;sub&#34;</span>:
</span></span><span style="display:flex;"><span>        user.ID = <span style="color:#ff79c6">*</span>attribute.Value
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;name&#34;</span>:
</span></span><span style="display:flex;"><span>        user.Name = <span style="color:#ff79c6">*</span>attribute.Value
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;email&#34;</span>:
</span></span><span style="display:flex;"><span>        user.Email = <span style="color:#ff79c6">*</span>attribute.Value
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;custom:custom_id&#34;</span>:
</span></span><span style="display:flex;"><span>        user.CustomID = <span style="color:#ff79c6">*</span>attribute.Value
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;email_verified&#34;</span>:
</span></span><span style="display:flex;"><span>        emailVerified, err <span style="color:#ff79c6">:=</span> strconv.<span style="color:#50fa7b">ParseBool</span>(<span style="color:#ff79c6">*</span>attribute.Value)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>          user.EmailVerified = emailVerified
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> user, <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>This will be the biggest function, we need to map what we receive from Cognito to our <code>UserResponse</code> struct, we do this with a <code>for</code> and a <code>switch</code>, of course we could improve it, but for the sake of example we will keep it like this. Also to map custom attributes we need to put <code>custom</code> before, like <code>custom:custom_id</code>.</p>
<p>We also check if the user passed the token in the header, if not we return an error.</p>
<p>Let&rsquo;s create the endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  r.<span style="color:#50fa7b">GET</span>(<span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#8be9fd;font-style:italic">func</span>(context <span style="color:#ff79c6">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>		user, err <span style="color:#ff79c6">:=</span> <span style="color:#50fa7b">GetUserByToken</span>(context, cognitoClient)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> err.<span style="color:#50fa7b">Error</span>() <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;token not found&#34;</span> {
</span></span><span style="display:flex;"><span>				context.<span style="color:#50fa7b">JSON</span>(http.StatusUnauthorized, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: <span style="color:#f1fa8c">&#34;token not found&#34;</span>})
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			context.<span style="color:#50fa7b">JSON</span>(http.StatusBadRequest, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: err.<span style="color:#50fa7b">Error</span>()})
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		context.<span style="color:#50fa7b">JSON</span>(http.StatusOK, gin.H{<span style="color:#f1fa8c">&#34;user&#34;</span>: user})
</span></span><span style="display:flex;"><span>	})
</span></span></code></pre></div><p>We perform the same validation as the other endpoints, but now we check the error type and if it is of the <code>token not found</code> type we return a <code>StatusUnauthorized</code>.</p>
<p>Let&rsquo;s test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#50fa7b">GET</span> http://localhost:8080/user <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
</span></span><span style="display:flex;"><span>content-type<span style="color:#ff79c6">:</span> application/json
</span></span><span style="display:flex;"><span>Authorization<span style="color:#ff79c6">:</span> Bearer token_jwt
</span></span></code></pre></div><p>Let&rsquo;s receive the user:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;user&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;50601dc9-7234-419a-8427-2a4bda92d33f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;John Doe&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;wivobi1159@bitofee.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;custom_id&#34;</span>: <span style="color:#f1fa8c">&#34;cb748d09-40de-457a-af23-ed9483d69f8d&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;email_verified&#34;</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="updating-password-1">Updating password</h3>
<p>Finally, let&rsquo;s create the <code>UpdatePassword</code> function that will update the user&rsquo;s password:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">UpdatePassword</span>(c <span style="color:#ff79c6">*</span>gin.Context, cognito congnitoClient.CognitoInterface) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>    token <span style="color:#ff79c6">:=</span> strings.<span style="color:#50fa7b">TrimPrefix</span>(c.<span style="color:#50fa7b">GetHeader</span>(<span style="color:#f1fa8c">&#34;Authorization&#34;</span>), <span style="color:#f1fa8c">&#34;Bearer &#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> token <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;token not found&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">var</span> user congnitoClient.UserLogin
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> c.<span style="color:#50fa7b">ShouldBindJSON</span>(<span style="color:#ff79c6">&amp;</span>user); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;invalid json&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    err <span style="color:#ff79c6">:=</span> cognito.<span style="color:#50fa7b">UpdatePassword</span>(<span style="color:#ff79c6">&amp;</span>user)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> errors.<span style="color:#50fa7b">New</span>(<span style="color:#f1fa8c">&#34;could not update password&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>We also make it mandatory to inform the token in the header, the rest of the function is what we have already done previously.</p>
<p>Let&rsquo;s create the last endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>  r.<span style="color:#50fa7b">PATCH</span>(<span style="color:#f1fa8c">&#34;user/password&#34;</span>, <span style="color:#8be9fd;font-style:italic">func</span>(context <span style="color:#ff79c6">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>		err <span style="color:#ff79c6">:=</span> <span style="color:#50fa7b">UpdatePassword</span>(context, cognitoClient)
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> err.<span style="color:#50fa7b">Error</span>() <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;token not found&#34;</span> {
</span></span><span style="display:flex;"><span>				context.<span style="color:#50fa7b">JSON</span>(http.StatusUnauthorized, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: <span style="color:#f1fa8c">&#34;token not found&#34;</span>})
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			context.<span style="color:#50fa7b">JSON</span>(http.StatusBadRequest, gin.H{<span style="color:#f1fa8c">&#34;error&#34;</span>: err.<span style="color:#50fa7b">Error</span>()})
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		context.<span style="color:#50fa7b">JSON</span>(http.StatusOK, gin.H{<span style="color:#f1fa8c">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;password updated&#34;</span>})
</span></span><span style="display:flex;"><span>	})
</span></span></code></pre></div><p>Let&rsquo;s make the call:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#50fa7b">PATCH</span> http://localhost:8080/user/password <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
</span></span><span style="display:flex;"><span>content-type<span style="color:#ff79c6">:</span> application/json
</span></span><span style="display:flex;"><span>Authorization<span style="color:#ff79c6">:</span> Bearer token_jwt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;wivobi1159@bitofee.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;password&#34;</span>: <span style="color:#f1fa8c">&#34;NovaSenha2@2222&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now when you update your password and try to log in you will receive an error, and if you use the new password, everything will work.</p>
<h2 id="final-considerations">Final considerations</h2>
<p>In this post we talk a little about Cognito, one of the many AWS services that many people don&rsquo;t know about but that helps a lot in the evolution of your system.</p>
<p>Cognito&rsquo;s practicality goes beyond what I&rsquo;ve discussed. Making a basic login is simple, but Cognito stands out for already providing you with an account verification system &ldquo;ready&rdquo;, a login option with social networks (which can be quite annoying to implement without Coginito), two-factor authentication, among others, and it also has AWS security to protect user data.</p>
<p>Cognito has more functionality, it&rsquo;s worth seeing all of them in the <a href="https://docs.aws.amazon.com/pt_br/cognito/latest/developerguide/what-is-amazon-cognito.html#what-is-amazon-cognito-features">documentation</a>.</p>
<h2 id="repository-link">Repository link</h2>
<p>Project <a href="https://github.com/wiliamvj/go-auth-cognito">repository</a></p>
<p>Subscribe and receive notification of new posts, <a href="https://wiliamvj.substack.com/">participate</a></p>
</section>

  

 <div class="giscus-comment">
  <script>
    let theme = localStorage.getItem('theme');
    const giscusTheme = theme === 'light' ? 'noborder_light' : 'noborder_dark';
    var currentUrl = window.location.href;
    const lang = currentUrl.indexOf('/en/') !== -1 ? 'en' : 'pt';
    let giscusAttributes = {
      id: 'giscus-script',
      src: 'https://giscus.app/client.js',
      'data-repo': 'wiliamvj\/wiliamvj.com',
      'data-repo-id': 'R_kgDOLkkfgA',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOLkkfgM4CeL5M',
      'data-mapping': 'title',
      'data-strict': '0',
      'data-reactions-enabled':
        '1',
      'data-emit-metadata':
        '0',
      'data-input-position':
        'top',
      'data-theme': theme,
      'data-lang': lang,
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: '',
    };

    let giscusScript = document.createElement('script');
    const article = document.querySelector('article');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    article.appendChild(giscusScript);
  </script>
</div>
 


 


  <footer>
    
  </footer>
</article>

</main><footer class="pt-5 pb-6 lg:grid lg:gap-3 lg:grid-cols-2">
  <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2025 —
  <a href="//localhost:1313/">Wiliam V. Joaquim</a>
  <span class="font-normal">with</span>
  <a
    href="https://github.com/nixentric/Lowkey-Hugo-Theme"
    target="_blank"
    rel="noopener noreferrer"
  >
    Lowkey
  </a>
</div>
 <div class="order-1 sm:order-2 f-social">
  <ul class="flex sm:justify-end gap-5">
     
    <li>
      <a href="https://www.linkedin.com/in/wiliamvj/" target="_blank" rel="noopener noreferrer"
        >linkedin</a
      >
    </li>
    
    <li>
      <a href="https://bsky.app/profile/wiliamvj.com" target="_blank" rel="noopener noreferrer"
        >bsky</a
      >
    </li>
    
    <li>
      <a href="https://twitter.com/wiliamjoaquim" target="_blank" rel="noopener noreferrer"
        >x</a
      >
    </li>
    
    <li>
      <a href="https://github.com/wiliamvj" target="_blank" rel="noopener noreferrer"
        >github</a
      >
    </li>
    
    <li>
      <a href="https://dev.to/wiliamvj" target="_blank" rel="noopener noreferrer"
        >dev.to</a
      >
    </li>
     
  </ul>
</div>

</footer>

<button
  type="button"
  data-twe-ripple-init
  data-twe-ripple-color="light"
  class="!fixed bottom-5 end-5 hidden rounded-md bg-wpurple p-3 text-xs font-medium uppercase leading-tight text-white shadow-md transition duration-150 ease-in-out hover:bg-wpurplehover hover:shadow-lg focus:bg-wpurplehover focus:shadow-lg focus:outline-none focus:ring-0 active:bg-wpurple active:shadow-lg"
  id="btn-back-to-top"
>
  <span class="[&>svg]:w-4">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="3"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"
      />
    </svg>
  </span>
</button>

<script defer>
  const mybutton = document.getElementById('btn-back-to-top');
  const scrollFunction = () => {
    if (
      document.body.scrollTop > 20 ||
      document.documentElement.scrollTop > 20
    ) {
      mybutton.classList.remove('hidden');
    } else {
      mybutton.classList.add('hidden');
    }
  };
  const backToTop = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  mybutton.addEventListener('click', backToTop);
  window.addEventListener('scroll', scrollFunction);
</script>
</body>
</html>
